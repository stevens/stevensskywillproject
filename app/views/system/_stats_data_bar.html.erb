<% max = 0 %>
<% for metric in metrics %>
  <% max = metric[:max] if metric[:max] && metric[:max] > max %>
<% end %>

<% for metric in metrics %>
  <% if metric[:value] && metric[:color] %>
    <% metric_bar_width = metric[:value] * 1.0 / max * 100 %>
    <div class="data_bar <%= metric[:color] %>_bar" style="width: <%= metric_bar_width %>%;">&nbsp;</div>
  <% end %>
<% end %>